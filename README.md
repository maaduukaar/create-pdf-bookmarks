# 📚 PDF Bookmarks Extractor

Инструмент для автоматического создания закладок (bookmarks) в PDF файлах на основе содержания из DOCX документов.

## 🎯 Возможности

- ✅ **Извлечение структуры** — автоматическое чтение содержания из DOCX файла
- ✅ **Иерархия закладок** — поддержка многоуровневой структуры (1, 1.1, 1.1.1, и т.д.)
- ✅ **Экспорт в JSON** — сохранение структуры закладок в формате JSON
- ✅ **Встраивание в PDF** — автоматическая вставка закладок в PDF файл
- ✅ **Drag & Drop** — просто перетащи DOCX на скрипт

## 📋 Требования

```bash
pip install python-docx PyMuPDF
```

- **python-docx** — для чтения DOCX файлов
- **PyMuPDF (fitz)** — для работы с PDF и встраивания закладок

## 🚀 Быстрый старт (краткая версия)

### Способ 1: Drag & Drop

Перетащи DOCX файл с содержанием на `bookmarks.py`

### Способ 2: Командная строка

```bash
python bookmarks.py document.docx
```

### Способ 3: Интерактивный режим

```bash
python bookmarks.py
```

Скрипт запросит путь к файлу.

## 🚀 Пошаговая инструкция

### Шаг 1: Подготовка файлов

1. **Подготовь DOCX с содержанием**
   - Открой документ Р7 Офис
   - Найди раздел "СОДЕРЖАНИЕ" или "ОГЛАВЛЕНИЕ"
   - Убедись, что каждая строка содержит:
     - Номер раздела (например: `1`, `1.1`, `2.3.4`)
     - Название раздела
     - Номер страницы (последнее число в строке)
   - Пример: `1.2.1 Функции модулей ПК «Органайзер ПРО» 5`
   - Сохрани как `.docx` файл

2. **Подготовь PDF файл (опционально)**
   - Если хочешь сразу встроить закладки в PDF, положи PDF рядом с DOCX
   - Дай PDF **то же имя**, что и DOCX
   - Пример: `Руководство.docx` и `Руководство.pdf` в одной папке

### Шаг 2: Установка зависимостей

3. **Установи Python** (если не установлен)
   - Скачай с [python.org](https://www.python.org/downloads/)
   - Версия 3.7 или выше

4. **Установи необходимые библиотеки**
   ```bash
   pip install python-docx PyMuPDF
   ```

### Шаг 3: Запуск скрипта

5. **Выбери способ запуска:**

   **Вариант А: Drag & Drop (самый простой)**
   - Перетащи DOCX файл на `bookmarks.py`
   - Скрипт автоматически запустится

   **Вариант Б: Командная строка**
   ```bash
   python bookmarks.py "C:\Документы\Руководство.docx"
   ```

   **Вариант В: Интерактивный режим**
   ```bash
   python bookmarks.py
   ```
   - Скрипт запросит путь к файлу
   - Введи полный путь и нажми Enter

### Шаг 4: Проверка результата

6. **Проверь созданные файлы**
   - В папке с DOCX появится `имя_файла_bookmarks.json`
   - Если PDF был найден, также появится `имя_файла_with_bookmarks.pdf`

7. **Открой PDF с закладками**
   - Открой файл `*_with_bookmarks.pdf`
   - В PDF Reader (Р7 Офис, Google Chrome, Adobe, Foxit и т.д.) открой панель закладок
   - Проверь, что структура закладок соответствует содержанию

### Шаг 5: Если что-то пошло не так

8. **PDF не найден автоматически?**
   - Скрипт запросит путь к PDF
   - Введи полный путь: `C:\Документы\Финальная_версия.pdf`
   - Или нажми `n` чтобы пропустить встраивание

9. **Закладки не создались?**
   - Проверь формат содержания в DOCX (см. раздел "Формат содержания")
   - Каждая строка должна начинаться с цифры и заканчиваться номером страницы

## 📝 Формат содержания в DOCX

Содержание должно ачинаться и заканчиваться на цифру:

```
1. НАЗНАЧЕНИЕ ПРОГРАММЫ.......5
1.1 Наименование программы       5
1.2 Функции программы_________5
1.2.1 Функции модулей ПК «Органайзер ПРО» 5
2. УСЛОВИЯ ВЫПОЛНЕНИЯ ПРОГРАММЫ 9
2.1 Технические требования 9
2.1.1 Требования к оборудованию 9
```

**Структура строки:**
- Номер раздела: `1`, `1.1`, `1.2.1` и т.д.
- Название раздела
- Номер страницы (последнее число в строке)

### Поддерживаемые форматы нумерации

- `1. Заголовок` — с точкой после номера
- `1 Заголовок` — без точки
- `1.1. Заголовок` — с точкой после всего номера
- `1.1 Заголовок` — стандартный формат

## 📦 Выходные файлы

### 1. JSON файл с закладками

`document_bookmarks.json` — структура закладок в формате PyMuPDF:

```json
[
  {
    "title": "1 НАЗНАЧЕНИЕ ПРОГРАММЫ",
    "dest": [5, "Fit"],
    "color": {"0": 0, "1": 0, "2": 0},
    "bold": false,
    "italic": false,
    "children": [
      {
        "title": "1.1 Наименование программы",
        "dest": [5, "Fit"],
        "children": []
      }
    ]
  }
]
```

### 2. PDF с закладками

`document_with_bookmarks.pdf` — копия PDF с встроенными закладками

## 🔧 Опции командной строки

```bash
# Тихий режим (минимум вывода)
python bookmarks.py --quiet document.docx
python bookmarks.py -q document.docx

# Справка
python bookmarks.py --help
```

## 💡 Примеры использования

### Пример 1: Базовое использование

```bash
python bookmarks.py "Руководство пользователя.docx"
```

**Результат:**
- `Руководство пользователя_bookmarks.json` — JSON с закладками
- `Руководство пользователя_with_bookmarks.pdf` — PDF с закладками (если найден подготовленный PDF)

### Пример 2: Указание пути к PDF вручную

Если PDF файл имеет другое имя:

```bash
python bookmarks.py manual.docx
# Скрипт запросит: Введи путь к PDF файлу
# Введи: C:\Documents\final-version.pdf
```

### Пример 3: Только JSON без встраивания

Если PyMuPDF не установлен, скрипт создаст только JSON файл:

```bash
# Без PyMuPDF
python bookmarks.py document.docx
# Создаст только: document_bookmarks.json
```

## 📐 Структура JSON

JSON файл содержит массив корневых закладок. Каждая закладка имеет:

| Поле | Тип | Описание |
|------|-----|----------|
| `title` | string | Название закладки с номером раздела |
| `dest` | array | `[страница, "Fit"]` — навигация к странице |
| `color` | object | RGB цвет: `{"0": 0, "1": 0, "2": 0}` (черный) |
| `bold` | boolean | Жирное начертание (по умолчанию false) |
| `italic` | boolean | Курсивное начертание (по умолчанию false) |
| `children` | array | Массив вложенных закладок |

## 🎨 Настройка закладок

Для изменения внешнего вида закладок отредактируй JSON перед встраиванием:

```json
{
  "title": "1 ВАЖНЫЙ РАЗДЕЛ",
  "dest": [5, "Fit"],
  "color": {"0": 1.0, "1": 0.0, "2": 0.0},  // Красный цвет
  "bold": true,                               // Жирный текст
  "italic": false
}
```

## 🐛 Решение проблем

### Закладки не находятся

**Проблема:** `⚠ Строки содержания не найдены!`

**Решение:**
1. Проверь формат содержания в DOCX
2. Убедись, что строки содержат: номер раздела + текст + номер страницы
3. Пример правильной строки: `1.2.1 Название раздела 15`

### PDF файл не найден

**Проблема:** `⚠ PDF файл с именем 'document.pdf' не найден`

**Решение:**
1. Убедись, что PDF имеет то же имя, что и DOCX
2. Или укажи путь к PDF вручную при запросе
3. Или используй только JSON (без встраивания)

### PyMuPDF не установлен

**Проблема:** `⚠ PyMuPDF не установлен - встраивание закладок недоступно`

**Решение:**
```bash
pip install PyMuPDF
```

### Неправильная кодировка в JSON

**Проблема:** Кириллица отображается как `\uXXXX`

**Решение:** JSON всегда сохраняется с `ensure_ascii=False`, кириллица должна читаться корректно. Открой в редакторе с поддержкой UTF-8.

## 📚 Технические детали

### Алгоритм извлечения

1. Читает все параграфы из DOCX
2. Применяет регулярное выражение: `^(\d+(?:\.\d+)*)\.?\s+(.+?)\s+(\d+)$`
3. Извлекает: номер раздела, название, номер страницы
4. Вычисляет уровень вложенности по количеству точек в номере
5. Строит иерархическое дерево закладок

### Формат destination

Используется формат `[page, "Fit"]`:
- `page` — номер страницы (1-based)
- `"Fit"` — режим отображения (вписать страницу в окно)

Альтернативные форматы:
- `[page, "XYZ", x, y, zoom]` — точное позиционирование
- `[page, "FitH", top]` — по ширине с указанием верхней точки

## 🤝 Вклад в проект

Нашел баг или есть идея для улучшения? Создай issue или pull request!

## 📄 Лицензия

MIT License — используй свободно для любых целей.

## 🔗 Связанные проекты

- [PyMuPDF](https://github.com/pymupdf/PyMuPDF) — работа с PDF
- [python-docx](https://github.com/python-openxml/python-docx) — работа с DOCX

---

**Автор:** АО Р7
**Версия:** 1.0.0  
**Дата:** 2025
